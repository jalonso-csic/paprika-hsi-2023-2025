# 03_preprocessing — Comparative preprocessing & PCA scores (FX10 / FX17)

## Data availability (Zenodo)
Clean input tables:
- **Paprika — VIS–NIR & SWIR tables with biochemical fields (v1)**
  DOI: https://doi.org/10.5281/zenodo.17523082

Preprocessed tables generated by these scripts (ready for step `04_supervised`):
- **Paprika — VIS–NIR & SWIR preprocessed tables for supervised HSI (FX10 & FX17)**
  DOI: https://doi.org/10.5281/zenodo.17539563

Files expected as inputs here:
- `FX10_con_bioquimicos_PUBLIC.xlsx`
- `FX17_con_bioquimicos_PUBLIC.xlsx`

## How to run
1. Put the input Excel files in your working folder:
   - `FX10_con_bioquimicos_PUBLIC.xlsx`
   - `FX17_con_bioquimicos_PUBLIC.xlsx`
2. In MATLAB, add this folder to the path:
   ```matlab
   addpath('code-matlab/03_preprocessing');
   ```
3. Run the desired script:
   ```matlab
   % VIS–NIR (Specim FX10)
   FX10_preproc_PCA_final

   % NIR–SWIR (Specim FX17)
   FX17_preproc_PCA_final
   ```

## What the scripts do
- Load spectra tables and detect spectral columns by prefix `R_`.
- Apply a comparative suite of preprocessing methods (SNV, MSC, mean centering, polynomial baseline, Savitzky–Golay 1st/2nd derivatives, and chained variants).
- Perform PCA on each preprocessed matrix and export score plots (light theme; `.jpg` + `.fig`).
- Compute diagnostics: PC1/PC2 variance, Leave-One-Out PLS-DA accuracy, Mahalanobis outlier count (PC1–PC2), and overall silhouette (PC1–PC2).
- Export a per-method preprocessed table (one Excel sheet per method) and a summary table.

## Outputs
- `Resultados_PCA_Finales_FX10/` (from `FX10_preproc_PCA_final.m`)
  - `Datos_Preprocesados_FX10.xlsx` — one sheet per preprocessing method.
  - `Resumen_Resultados.xlsx` — metrics sorted by PLS-DA accuracy.
  - `Figuras_PCA_Scores/*.jpg` and `*.fig` — all figures left open for editing.
- `Resultados_PCA_Finales_FX17/` (from `FX17_preproc_PCA_final.m`)
  - `Datos_Preprocesados_FX17.xlsx` — one sheet per preprocessing method.
  - `Resumen_Resultados.xlsx`
  - `Figuras_PCA_Scores/*.jpg` and `*.fig`

## Notes
- No hard-coded paths; scripts operate in the current working folder.
- Grouping column is auto-detected in this order: `Año`, `Anio`, `Year`, `Tratamiento`.
- Excel sheet names are sanitized (≤31 chars); writing uses overwrite-by-sheet.
- Default fonts/colors enforce a white (light) theme for publication-ready figures.
